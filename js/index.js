$(function(){function t(t,a){$(".captcha").append('<img src="'+t+'">').find("input").val(a)}function a(t,a){$(".form-memory .captcha > img").attr("src",t),$(".form-memory .captcha > input").val(a)}$.get("http://zheny-memory.underoot.ru/captcha",function(a){t(a.image,a.uid)}).fail(function(){$(".form-memory").html(new String('<div class="alert alert-info alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Закрыть</span></button><strong>Сервер временно не доступен!</strong> Попробуйте повторить запрос позднее или оправьте воспоминание <a href="mailto:alexshoronov@gmail.com">сюда</a>!</div>'))}),$("#update_captcha").click(function(){$.get("http://zheny-memory.underoot.ru/captcha",function(t){a(t.image,t.uid)})}),$("#submit").click(function(){var t=!0;return $(".form-memory input.form-control").each(function(){""===$(this).val().trim()&&(t=!1)}),t?void $.ajax("http://zheny-memory.underoot.ru",{type:"PUT",data:$(".form-memory").serialize()}).fail(function(t){var s=t.responseJSON;if(void 0===s)return void $(".form-memory").html(new String('<div class="alert alert-info alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Закрыть</span></button><strong>Сервер временно не доступен!</strong> Попробуйте повторить запрос позднее или оправьте сообщение <a href="mailto:alexshoronov@gmail.com">сюда</a></div>'));switch(a(s.image,s.uid),$('.row-captcha input[name="captcha"]').val(""),t.status){case 403:$(".form-memory").append(new String('<div class="alert alert-warning alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Закрыть</span></button><strong>Код с картинки введен неверно!</strong></div>'));break;case 404:$(".form-memory").append(new String('<div class="alert alert-warning alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Закрыть</span></button><strong>Превышен тайм-аут запроса!</strong></div>'));break;case 500:$(".form-memory").html(new String('<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Закрыть</span></button><strong>Ошибка на сервере!</strong> Попробуйте повторить запрос позднее!</div>'))}}).done(function(){$(".form-memory").html(new String('<div class="alert alert-success alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Закрыть</span></button><strong>Сообщение отправлено!</strong> После проверки администратором ваше воспоминание появится здесь!</div>'))}):void $(".form-memory").append(new String('<div class="alert alert-warning alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Закрыть</span></button><strong>Должны быть заполнены все поля!</strong></div>'))})});